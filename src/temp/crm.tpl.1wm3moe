<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
	<title>Mini CRM</title>
	<style type="text/css">
		<?php echo  Web::minify('ui/',array('style.css'),FALSE) ; ?>
		<?php echo  Web::minify('ui/',array('app.css'),FALSE) ; ?>
	</style>
</head>
<body>
	<div class="header">
		<h4>Description</h4>
		<h1>The mini CRM</h1>
                <ul class="menu">
                  <li><a href="/news">News</a></li>
                  <li><a href="/profiles">Profiles</a></li>
                  <li><a href="/corespondence">Correspondence</a></li>
                  <li><a href="/services">Services</a></li>
                  <li><a href="/todo">To Do</a></li>
                  <li><a href="/finance">Finance</a></li>
                  <li><a href="/reports">Reports</a></li>
                  <li><a href="/help">Help</a></li>
                  <li><a href="/settings">Settings</a></li>
                </ul>
	</div>
	<div id="content" class="content">
          <form id="profile_manage" action="/profiles/manage" method="post"></form>
<ul class="menu" style="float:right">
  <li><a href="/profiles/list">List Profiles</a></li>
  <li><a href="/profiles/add">Add Profile</a></li>
  <li><a href="/profiles/statistics">Statistics</a></li>
  <li><a href="/profiles/search">Search</a></li>
</ul>
<div style="clear:left"> </div>
<h4><?php echo  (F3::get('ESCAPE')?F3::htmlencode(($_profile_page_title=F3::get('profile_page_title'))):($_profile_page_title=F3::get('profile_page_title'))) ; ?></h4>
<div id="profile_list"></div>
<div style="clear:left"></div>
<script type="text/javascript">
(function() {
    var httpRequest;
    makeRequest('GET', '/profiles/manage/0');
    
    function makeRequest(method, url) {
        if (window.XMLHttpRequest) { // Mozilla, Safari, ...
            httpRequest = new XMLHttpRequest();
        } else if (window.ActiveXObject) { // IE
            try {
                httpRequest = new ActiveXObject("Msxml2.XMLHTTP");
            }
            catch (e) {
                try {
                    httpRequest = new ActiveXObject("Microsoft.XMLHTTP");
                } catch (e) {}
            }
        }
        
        if (!httpRequest) {
            alert('Giving up :( Cannot create an XMLHTTP instance');
            return false;
        }

        httpRequest.onreadystatechange = alertContents;
        httpRequest.open(method, url, true);
        httpRequest.send();
    }
    
    function alertContents() {
        if (httpRequest.readyState === 4) {
            if (httpRequest.status === 200) {
                var response = JSON.parse(httpRequest.responseText);
                var container = document.getElementById('profile_list');
                for(var max=response.length, i=0; i<max; i++){
                    var profile = document.createElement('DIV');
                    profile.setAttribute('style', 'width:22%;margin:10px;float:left')
                    var name = document.createElement('H5');
                    name.appendChild(document.createTextNode(response[i].name));
                    var statistics = document.createElement('P');
                    statistics.setAttribute('style', 'font-size:0.7em;margin:0');
                    statistics.appendChild(document.createTextNode('Shown: '+ response[i].show +'; Clicked: '+ response[i].click));
                    var description = document.createElement('P');
                    description.appendChild(document.createTextNode(response[i].description));
                    profile.appendChild(name);
                    profile.appendChild(statistics);
                    profile.appendChild(description);
                    container.appendChild(profile);
                }
                console.log(response);
            } else {
                alert('There was a problem with the request.');
            }
        }
    }
})();
</script>


<script type="text/javascript">
var restfull_elms = Array.filter(
    document.getElementsByClassName('restfull'),
    function(elem){
        return elem.nodeName == 'A';
    });

for(var max=restfull_elms.length, i=0; i<max; i++){
    var form = document.createElement("form");
    form.setAttribute('id', 'profiles_manage_form_'+i);
    form.setAttribute('name', 'profiles_manage_form_'+i);
    form.setAttribute('action', restfull_elms[i].getAttribute('href'));
    form.setAttribute('method', restfull_elms[i].dataset.method);
    document.body.insertBefore(form, document.getElementById("content"));
    restfull_elms[i].setAttribute('href', '#');
    var form_name = 'profiles_manage_form_'+i;
    restfull_elms[i].onclick = function(e){document.forms[form_name].submit();}
}

</script>

	</div>
	<div class="footer">
		<h5>miniCRM is licensed under the terms of the GPL v3. Copyright &copy; 2012-2013</h5>
	</div>
</body>
</html>
